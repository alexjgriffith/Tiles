function triangle(e,t,n,a,o){var r=n/2;return[{x:e+a*Math.cos(o),y:t+a*Math.sin(o)},{x:e-r*Math.cos(Math.PI/2-o),y:t+r*Math.sin(Math.PI/2-o)},{x:e-r*Math.cos(Math.PI/2+o),y:t-r*Math.sin(Math.PI/2+o)}]}function trunktriangle(e,t,n,a,o,r){var c=n/2,i=a/2,l=Math.sqrt(o*o+i*i),s=Math.atan2(o,i);return[{x:e-c*Math.cos(r+Math.PI/2),y:t-c*Math.sin(r+Math.PI/2)},{x:e-c*Math.cos(3*Math.PI/2+r),y:t-c*Math.sin(3*Math.PI/2+r)},{x:e-l*Math.cos(r+s),y:t-l*Math.sin(r+s)},{x:e-l*Math.cos(r-s),y:t-l*Math.sin(r-s)}]}function fillPoly(e,t,n){e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var a=1;a<t.length;a++)e.lineTo(t[a].x,t[a].y);e.lineTo(t[0].x,t[0].y),e.fillStyle=n,e.fill()}function rotate(e,t){var n=Math.sqrt(e.x*e.x+e.y*e.y),a=Math.atan2(e.y,e.x);return e.x=n*Math.cos(a+t),e.y=n*Math.sin(a+t),e}function tileOverlap(e,t,n,a,o,r){return comparePoints(n,a,o,r,e,75,75,t)}function comparePoints(e,t,n,a,o,r,c,i){var l=pointToTile(t,n,r,c,o),s=pointToTile(t,a,r,c,o),d=pointToTile(e,a,r,c,o),u=pointToTile(e,n,r,c,o),y={xmin:e,xmax:t,ymin:n,ymax:a},m=(t-e)*(a-n),x=comparePointA(m,t,n,l.pos.x,l.pos.y,r,c,y)*i,p=comparePointB(m,t,a,s.pos.x,s.pos.y,r,c,y)*i,h=comparePointC(m,e,a,d.pos.x,d.pos.y,r,c,y)*i,f=comparePointD(m,e,n,u.pos.x,u.pos.y,r,c,y)*i,v={red:0,blue:0,green:0},g={earth:"red",grass:"green",water:"blue"};return v[g[l.type]]+=x,v[g[s.type]]+=p,v[g[d.type]]+=h,v[g[u.type]]+=f,v}function comparePointA(e,t,n,a,o,r,c,i){var l=a-r,s=(t-l)*(o-n),d=(t-i.xmin)*(o-n),u=(t-l)*(i.ymax-n);return Math.min(e,s,d,u)}function comparePointB(e,t,n,a,o,r,c,i){var l=a-r,s=o-c,d=(t-l)*(n-s),u=(t-i.xmin)*(n-s),y=(t-l)*(n-i.ymin);return Math.min(e,d,u,y)}function comparePointC(e,t,n,a,o,r,c,i){var l=o-c,s=(a-t)*(n-l),d=(i.xmax-t)*(n-l),u=(a-t)*(n-i.ymin);return Math.min(e,s,d,u)}function comparePointD(e,t,n,a,o,r,c,i){var l=(a-t)*(o-n),s=(i.xmax-t)*(o-n),d=(a-t)*(i.ymax-n);return Math.min(e,l,s,d)}function tileOverlapMaxColour(e){var t=0,n=0,a=0;for(i in e)t+=e[i].red,a+=e[i].blue,n+=e[i].green;return maxColour(t,a,n)}function maxColour(e,t,n){var a;return e>t&&e>n?a=["red"]:n>t&&n>e?a=["green"]:t>n&&t>e?a=["blue"]:e==n&&e==t?a=["red","blue","green"]:e==n&&n>0?a=["red","green"]:e==t&&t>0?a=["red","blue"]:t==n&&n>0&&(a=["green","blue"]),a[Math.floor(Math.random()*a.length)]}function pointToTile(e,t,n,a,o){return o[Math.floor(e/n)][Math.floor(t/a)]}function pdiff(e,t){return{x:e.x-t.x,y:e.y-t.y}}function padd(e,t){return{x:e.x+t.x,y:e.y+t.y}}function anlge(e,t){var n=pdiff(e,t);return Math.atan2(n.y,n.x)}function slope(e,t){return(t.y-e.y)/(t.x-e.x)}function radslope(e,t){var n=e*Math.sqrt(1/(t*t+1));return{x:n,y:n*t}}function pdist(e,t){var n=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y);return Math.sqrt(n)}function pass1(e){return e}function pass0(){}function mouseCameraAlt(e,t){var n={x:e.dim.x/2,y:e.dim.y/2},a=mouse.pos,o={};o.x=t.x-n.x,o.y=t.y-n.y;var r={};r.x=t.x-n.x+(a.x-n.x)/1.5,r.y=t.y-n.y+(a.y-n.y)/1.5;var c=Math.atan2(r.y-o.y,r.x-o.x),i={x:250*Math.cos(c),y:250*Math.sin(c)},l={x:o.x+i.x,y:o.y+i.y};return pdist(o,r)<250?(r.x<0?e.camera.x=0:r.x>e.range.x-e.dim.x?e.camera.x=e.range.x-e.dim.x:e.camera.x=r.x,r.y<0?e.camera.y=0:r.y>e.range.y-e.dim.y?e.camera.y=e.range.y-e.dim.y:e.camera.y=r.y):(l.x<0?e.camera.y=0:l.x>e.range.x-e.dim.x?e.camera.x=e.range.x-e.dim.x:e.camera.x=l.x,l.y<0?e.camera.y=0:l.y>e.range.y-e.dim.y?e.camera.y=e.range.y-e.dim.y:e.camera.y=l.y),e}function mouseCamera(e,t){var n=mouse.pos,a={},o={},r={};r.x=.3*e.dim.x,r.y=.3*e.dim.y,a.x=e.dim.x/2,a.y=e.dim.y/2;var c=Math.atan2(n.y-(t.y-e.camera.y),n.x-(t.x-e.camera.x));return o.x=Math.cos(c)*r.x,o.y=Math.sin(c)*r.y,t.x-a.x+o.x<0?e.camera.x=0:t.x-a.x+o.x>e.range.x-e.dim.x?e.camera.x=e.range.x-e.dim.x:e.camera.x=t.x-a.x+o.x,t.y-a.y+o.y<0?e.camera.y=0:t.y-a.y+o.y>e.range.y-e.dim.y?e.camera.y=e.range.y-e.dim.y:e.camera.y=t.y-a.y+o.y,e}function lagCamera(e,t){var n={},a={};return n.x=e.dim.x/2,n.y=e.dim.y/2,a.x=.9*(e.camera.x-(t.x-n.x)),t.x-n.x+a.x<0?e.camera.x=0:t.x-n.x+a.x>e.range.x-e.dim.x?e.camera.x=e.range.x-e.dim.x:e.camera.x=t.x-n.x+a.x,a.y=.9*(e.camera.y-(t.y-n.y)),t.y-n.y+a.y<0?e.camera.y=0:t.y-n.y+a.y>e.range.y-e.dim.y?e.camera.y=e.range.y-e.dim.y:e.camera.y=t.y-n.y+a.y,e}function definePlayer(e,t){playerId=c2e.addEnt(),c2e.addContext(playerId,"pos",[e.pos.x,e.pos.y]),addDraw(playerId,"circle","black",25,t),c2e.addContext(playerId,"colour",[e.colour]),c2e.addContext(playerId,"power",[e.power.red,e.power.blue,e.power.green]),c2e.addContext(playerId,"powerBuildUp",[1e3]),c2e.addContext(playerId,"health",[e.health]),c2e.addContext(playerId,"id",[e.id]),c2e.addContext(playerId,"team",[e.team]),c2e.addContext(playerId,"player",[]),c2e.addContext(playerId,"match",[]),c2e.addContext(playerId,"alive",[e.alive]),c2e.addContext(playerId,"direction",[e.dir.x,e.dir.y]),c2e.addContext(playerId,"sentDirection",[e.dir.x,e.dir.y]),c2e.addContext(playerId,"collider",[50,50,!1,!0,100,[]])}function defineOtherPlayer(e,t,n,a,o){var r=c2e.addEnt();otherPlayers.push(r),c2e.addContext(r,a,o),c2e.addContext(r,"colour",["grey"]),c2e.addContext(r,"pos",[t,n]),c2e.addContext(r,"draw",["circle","black",25]),c2e.addContext(r,"team",[e]),c2e.addContext(r,"otherPlayer",[]),c2e.addContext(playerId,"alive",[!0]),c2e.addContext(r,"direction",[1,0]),c2e.addContext(r,"collider",[50,50,!1,!0,100,[]])}function createBullet(e,t,n,a,o,r,c){var i=c2e.addEnt();c2e.addContext(i,"id",[c]),c2e.addContext(i,"uid",[e]),c2e.addContext(i,"pos",[t.x,t.y]),c2e.addContext(i,"draw",["cicle","black",5]),c2e.addContext(i,"colour",[function(e){return params.colours[{red:"team1",blue:"team2",green:"team3",black:"dead",yellow:"hitExp",white:"behind"}[e]]}(r)]),c2e.addContext(i,"bullet",[o,a,t]),c2e.addContext(i,"damage",[1]),c2e.addContext(i,"collider",[5,5,!1,!0,0,[]]),c2e.addContext(i,"velocity",[n.x,n.y])}function createExplosion(e,t,n,a,o){var r=c2e.addEnt();c2e.addContext(r,"pos",[e.x,e.y]),c2e.addContext(r,"draw",["cicle","black",n]),c2e.addContext(r,"colour",[function(e){return params.colours[{red:"team1",blue:"team2",green:"team3",black:"dead",yellow:"hitExp",white:"behind"}[e]]}("yellow")]),c2e.addContext(r,"explosion",[o,a]),c2e.addContext(r,"expanding",[t]),c2e.addContext(r,"circle",[n])}function placeObject(e,t){var n=c2e.addEnt();object.push(n),c2e.addContext(n,"pos",[e,t]),c2e.addContext(n,"draw",["circle","black",25]),c2e.addContext(n,"colour",["yellow"]),c2e.addContext(n,"collider",[50,50,!1,!1,50,[]])}function defineBoundBox(e,t){bounds=c2e.addEnt(),c2e.addContext(bounds,"pos",[1,1]),c2e.addContext(bounds,"collider",[e-2,t-2,!0,!1,0,[]])}function testCollision(){var e=c2e.alle("player")[0],t=c2e.alle("bullet");c2e.applySystem("collideI",[e,bounds],[]);for(var n in object)c2e.applySystem("collide",[e,object[n]],[]);for(var n in otherPlayers){c2e.applySystem("collide",[e,otherPlayers[n]],[]),c2e.applySystem("collideI",[otherPlayers[n],bounds],[]);for(var a in otherPlayers)a!=n&&c2e.applySystem("collide",[otherPlayers[n],otherPlayers[a]],[])}for(var n in t)c2e.applySystem("triggerCollide",[e,t[n]],[bulletEvent])}function move(e,t,n){"down"==e&&c2e.applySystem("movePlayer",[n],[{x:0,y:t}]),"up"==e&&c2e.applySystem("movePlayer",[n],[{x:0,y:-t}]),"right"==e&&c2e.applySystem("movePlayer",[n],[{x:t,y:0}]),"left"==e&&c2e.applySystem("movePlayer",[n],[{x:-t,y:0}])}function pdraw(e,t,n){var a=c2e.alle("player")[0],o=new Date;c2e.applySystem("damageAnimate",[a],[o.getTime()]),c2e.applySystem("drawPlayer",[a],[e,t,n])}function opdraw(e,t){for(i in otherPlayers)c2e.applySystem("drawOtherPlayer",[otherPlayers[i]],[e,t])}function odraw(e,t){for(i in object)c2e.applySystem("drawObj",[object[i]],[e,t])}function bdraw(e,t){var n=c2e.alle("bullet");for(i in n)c2e.applySystem("drawObj",[n[i]],[e,t])}function opldraw(e,t){var n=c2e.alle("otherPlayerLive"),a=(new Date).getTime();for(i in n)c2e.applySystem("damageAnimate",[n[i]],[a]),c2e.applySystem("drawOtherPlayer",[n[i]],[e,t])}function edraw(e,t){var n=c2e.alle("explosion");for(i in n)c2e.applySystem("drawObj",[n[i]],[e,t])}function updateBullets(e){var t=c2e.alle("bullet");for(i in t)c2e.applySystem("updateBullet",[t[i]],[e,t[i]])}function updateExplosions(e){var t=c2e.alle("explosion");for(i in t)c2e.applySystem("updateExplosion",[t[i]],[e,t[i]])}function playerPos(){return c2e.allc(playerId).pos}function drawCollider(t,n,a){e=c2e.allc(n),t.rect(e.pos.x-a.x,e.pos.y-a.y,e.collider.x,e.collider.y),t.strokeStyle="red",t.stroke()}function playerUpdateDirection(e,t){c2e.applySystem("playerDirection",[playerId],[e,t])}function runOtherPlayerAI(e){for(i in otherPlayers)c2e.applySystem("simpleAI",[otherPlayers[i]],[e])}function playerCreateBullet(){var e=c2e.alle("player");for(i in e)c2e.applySystem("playerCreateBullet",[e[i]],[])}function updatePlayer(e,t){var n=c2e.alle("player"),a=new Date;for(i in n)c2e.applySystem("updatePlayer",[n[i]],[e,a.getTime(),t])}function playerCreateExplosion(){var e=c2e.allc(playerId),t={};t.x=e.pos.x-25+250*e.direction.x,t.y=e.pos.y-25+250*e.direction.y,createExplosion(t,5,25,150,"red")}function clickCreateExplosion(e,t){var n={};n.x=e,n.y=t,websocketSendEvent("createExplosion",{pos:n,rate:5,initialRadius:0,finalRadius:150,team:"red"})}function moveKeyDown(e){c2e.applySystem("sendKey",[playerId],["keyDown",e])}function moveKeyUp(e){c2e.applySystem("sendKey",[playerId],["keyUp",e])}function sendPlayerAngle(){c2e.applySystem("sendAngle",[playerId],[])}function sendPlayerPos(){c2e.applySystem("sendPos",[playerId],[])}function createOtherPlayerLive(e,t,n,a,o,r,c){var i=c2e.addEnt();otherPlayersLive[r]=i,c2e.addContext(i,"pos",[e.x,e.y]),c2e.addContext(i,"colour",[n]),c2e.addContext(i,"draw",["circle","black",25]),c2e.addContext(i,"team",[t]),c2e.addContext(i,"otherPlayerLive",[]),c2e.addContext(i,"moveKeys",[]),c2e.addContext(i,"match",[]),c2e.addContext(i,"id",[r]),c2e.addContext(i,"alive",[a]),c2e.addContext(i,"direction",[o.x,o.y]),c2e.addContext(i,"collider",[50,50,!1,!0,100,[]])}function updateOtherPlayerLive(e,t,n,a,o,r){c2e.applySystem("updateOtherPlayerLive",[e],[t,n,a,o,r])}function moveOthers(e){var t=c2e.alle("otherPlayerLive");for(var n in t)c2e.applySystem("moveOtherPlayer",[t[n]],[t[n],e])}function updatePlayerPos(e,t,n,a,o,r,c){var i=function(e){return params.colours[{red:"team1",blue:"team2",green:"team3",black:"dead",yellow:"hitExp",white:"behind"}[e]]};c[1]!=clientID[1]&&(Object.keys(otherPlayersLive).includes(r.toString())?updateOtherPlayerLive(otherPlayersLive[r],e,t,i(n),a,o):createOtherPlayerLive(e,t,i(n),a,o,r,c))}function createQuickButton(e,t,n,a,o){return createMenuButton(e,a,o,300,50,"30px Impact","40px Impact","white","blue",t,n)}function createMenuButton(e,t,n,a,o,r,c,i,l,s,d){var u=c2e.addEnt();return c2e.addContext(u,"text",[e,e,r,c,i,i]),c2e.addContext(u,"backgroundBox",[l,l,null,"black",null,5]),c2e.addContext(u,"boundingBox",[a,o]),c2e.addContext(u,"event",[s]),c2e.addContext(u,"hoverEvent",[d]),c2e.addContext(u,"hovered",[!1]),c2e.addContext(u,"pos",[t,n]),c2e.addContext(u,"loadMenu",[]),u}function updateButtons(e,t,n){var a=c2e.alle("hovered");for(i in a)c2e.applySystem("updateButton",[a[i]],[e,t,n])}function drawButtons(e,t){var n=c2e.alle("hovered");for(i in n)c2e.applySystem("drawButton",[n[i]],[e,t])}function drawColouredButtons(e){var t=c2e.alle("colouredBackgroundBox");for(i in t)c2e.applySystem("drawColouredButton",[t[i]],[e])}function clearLoadMenu(){var e=c2e.alle("loadMenu");for(i in e)c2e.removeEnt(e[i])}function clearMatchlist(){var e=c2e.alle("matchlist");for(i in e)c2e.removeEnt(e[i])}function clearMatch(){delete playerId,delete bounds,object=[],otherPlayersLive={},otherPlayers={};var e=c2e.alle("match");for(i in e)c2e.removeEnt(e[i])}function clearLoadingScreen(){var e=c2e.alle("loadingScreen");for(i in e)c2e.removeEnt(e[i])}function damaged(e,t,n,a,o,r){var c=!1,i=c2e.alle("bullet");for(var l in i)e==c2e.allc(i[l]).uid.id&&(c=i[l]);r[1]!=clientID[1]&&c&&Object.keys(otherPlayersLive).includes(o.toString())&&c2e.applySystem("otherDamage",[otherPlayersLive[o],c],[])}function dead(e,t,n){Object.keys(otherPlayersLive).includes(t.toString())&&c2e.applySystem("receiveDead",[otherPlayersLive[t]],[e])}function keyUp(e,t){Object.keys(otherPlayersLive).includes(t.toString())&&c2e.applySystem("receiveKeyUp",[otherPlayersLive[t]],[e])}function keyDown(e,t){Object.keys(otherPlayersLive).includes(t.toString())&&c2e.applySystem("receiveKeyDown",[otherPlayersLive[t]],[e])}function turned(e,t){Object.keys(otherPlayersLive).includes(t.toString())&&c2e.applySystem("turnOther",[otherPlayersLive[t]],[e])}function colourChanged(e,t){Object.keys(otherPlayersLive).includes(t.toString())&&c2e.applySystem("setOtherColour",[otherPlayersLive[t]],[e])}function die(){var e=c2e.alle("player")[0];c2e.applySystem("die",[e],[])}function createQuickMatchButton(e,t,n,a,o){return createMatchButton(e,a,o,300,50,"30px Impact","40px Impact","white","blue",t,n)}function createMatchButton(e,t,n,a,o,r,c,i,l,s,d){var u=c2e.addEnt();return c2e.addContext(u,"text",[e,e,r,c,i,i]),c2e.addContext(u,"backgroundBox",[l,l,null,"black",null,5]),c2e.addContext(u,"boundingBox",[a,o]),c2e.addContext(u,"event",[s]),c2e.addContext(u,"hoverEvent",[d]),c2e.addContext(u,"hovered",[!1]),c2e.addContext(u,"pos",[t,n]),c2e.addContext(u,"match",[]),u}function sendExit(){var e=c2e.alle("player")[0];c2e.applySystem("sendExit",[e],[])}function exitMatch(e,t){Object.keys(otherPlayersLive).includes(e.toString())&&(c2e.applySystem("receiveExit",[otherPlayersLive[e]],[]),delete otherPlayersLive[e])}function quickMatchListButton(e,t,n,a,o){return createMatchListButton(n,200,2*e.canvas.height/8+65*t,300,50,"30px Impact","40px Impact","white","blue",a,o)}function createMatchListButton(e,t,n,a,o,r,c,i,l,s,d){var u=c2e.addEnt();return c2e.addContext(u,"text",[e,e,r,c,i,i]),c2e.addContext(u,"backgroundBox",[l,l,null,"black",null,5]),c2e.addContext(u,"boundingBox",[a,o]),c2e.addContext(u,"event",[s]),c2e.addContext(u,"hoverEvent",[d]),c2e.addContext(u,"hovered",[!1]),c2e.addContext(u,"pos",[t,n]),c2e.addContext(u,"matchlist",[]),u}function createMatchListButtons(e,t,n,a,o,r){var c=Object.values(t.list),i=Object.keys(t.list),l=-1;for(var l in c)l<=5&&quickMatchListButton(e,l,"Match: "+i[l],n(l),a(l));(l=i.length)<=5&&quickMatchListButton(e,l,"New Match",o,r)}function quickPlayerButton(e,t,n,a,o,r,c,i,l){return createMatchListButton(c,e+o*(n+10),t+r*(a+10),n,a,"30px Impact","40px Impact","white","blue",i,l)}function createPlayerButton(e,t,n,a,o,r,c,i,l,s,d){var u=c2e.addEnt();return c2e.addContext(u,"text",[e,e,r,c,i,i]),c2e.addContext(u,"backgroundBox",[l,l,null,"black",null,5]),c2e.addContext(u,"boundingBox",[a,o]),c2e.addContext(u,"event",[s]),c2e.addContext(u,"hoverEvent",[d]),c2e.addContext(u,"hovered",[!1]),c2e.addContext(u,"pos",[t,n]),c2e.addContext(u,"matchlist",[]),u}function createPlayerGrid(e,t,n,a){for(var o=e.canvas.width/2,r=2*e.canvas.height/8-25,c=0;c<4;c++)for(var i=0;i<5;i++)quickPlayerButton(o+40.5+10,r+31.5+10,81,63,c,i,"X",n,a),0}function addDraw(e,t,n,a,o){return o?c2e.addContext(e,"draw",[t,n,a,o.team1,o.team2,o.team3,o.dead,o.pointer,o.hitExp,o.accent,o.behind]):c2e.addContext(e,"draw",[t,n,a,"red","green","blue","black","yellow","yellow","yellow","white"]),e}function CES(){var e={},t={},n={},a=0,o={},r={};this.viewObj=function(){return{c2e:e,e2c:t,ents:n}},this.addEnt=function(){return n[a]={},t[a]=[],(a+=1)-1},this.removeEnt=function(a){delete n[a];for(var o in t[a])e[t[a][o]]=e[t[a][o]].filter(function(e){return e!=a});delete t[a]},this.addContext=function(a,o,c){var i=r[o].apply(void 0,c);n[a][o]=i,t[a].push(o),null==e[o]?e[o]=[a]:e[o].push(a)},this.removeContext=function(a,o){t=t[a].filter(function(e){}),e=e[o].filter(function(e){ent}),delete n[a][o]},this.defcontext=function(e,t){r[e]=t},this.alle=function(t){return e[t]},this.allc=function(e){return n[e]},this.defsystem=function(e,t,n){o[e]={fun:t,depends:n}},this.applySystem=function(e,t,a){var r;1==t.length?(a.reverse().push(n[t[0]]),a.reverse(),fun=o[e].fun,null!=(r=fun.apply(void 0,a))?n[t[0]]=r:this.removeEnt(t[0])):(t.length=2)&&(a.reverse().push(n[t[1]]),a.push(n[t[0]]),a.reverse(),fun=o[e].fun,null!=(r=fun.apply(void 0,a))[0]?n[t[0]]=r[0]:this.removeEnt(t[0]),null!=r[1]?n[t[1]]=r[1]:this.removeEnt(t[1]))}}function collider(e,t){var n=e.collider,a=e.pos,o=t.collider,r=t.pos,c=a.x-(r.x+o.x),i=r.x-(a.x+n.x),l=a.y-(r.y+o.y),s=r.y-(a.y+n.y);return{col:c<0&&i<0&&l<0&&s<0,overlap:{xl:c,xu:i,yl:l,yu:s}}}function icollider(e,t){var n=e.collider,a=e.pos,o=t.collider,r=t.pos,c=a.x-r.x,i=r.x+o.x-(a.x+n.x),l=a.y-r.y,s=r.y+o.y-(a.y+n.y);return{col:!(c>0&&i>0&&l>0&&s>0),overlap:{xl:c,xu:i,yl:l,yu:s}}}function systemTriggerCollide(e,t,n){var a=collider(e,t),o=[e,t];return a.col&&(o=n(e,t,a.overlap)),o}function bulletEvent(e,t,n){return rets=systemDamage(e,t),rets}function deathTrigger(e,t,n){return e.keys().includes("alive").state&&(e.draw.fillColour="black"),t.keys().includes("alive").state&&(t.draw.fillColour="black"),[e,t]}function systemInverseCollide(e,t){var n=icollider(e,t),a=n.overlap.xl,o=n.overlap.xu,r=n.overlap.yl,c=n.overlap.yu;return n.col&&!t.collider.moveable&&e.collider.moveable&&(a<0?e.pos.x-=a:o<0&&(e.pos.x+=o),r<0?e.pos.y-=r:c<0&&(e.pos.y+=c)),[e,t]}function systemCollide(e,t){var n,a=collider(e,t),o=a.overlap.xl,r=a.overlap.xu,c=a.overlap.yl,i=a.overlap.yu;return a.col&&(o<0&&o>r&&o>c&&o>i?(e=(n=resolveXL(e,t,o))[0],t=n[1]):r<0&&r>o&&r>c&&r>i&&(e=(n=resolveXU(e,t,r))[0],t=n[1]),c<0&&c>o&&c>r&&c>i?(e=(n=resolveYL(e,t,c))[0],t=n[1]):i<0&&i>o&&i>r&&i>c&&(e=(n=resolveYU(e,t,i))[0],t=n[1])),[e,t]}function resolveXL(e,t,n){var a=e.collider.mass+t.collider.mass;return e.collider.moveable&&t.collider.moveable?(e.pos.x-=n*t.collider.mass/a,t.pos.x+=n*e.collider.mass/a):e.collider.moveable?t.collider.moveable||(e.pos.x-=n):t.pos.x+=n,[e,t]}function resolveXU(e,t,n){var a=e.collider.mass+t.collider.mass;return e.collider.moveable&&t.collider.moveable?(e.pos.x+=n*t.collider.mass/a,t.pos.x-=n*e.collider.mass/a):e.collider.moveable?t.collider.moveable||(e.pos.x+=n):t.pos.x-=n,[e,t]}function resolveYL(e,t,n){var a=e.collider.mass+t.collider.mass;return e.collider.moveable&&t.collider.moveable?(e.pos.y-=n*t.collider.mass/a,t.pos.y+=n*e.collider.mass/a):e.collider.moveable?t.collider.moveable||(e.pos.y-=n):t.pos.y+=n,[e,t]}function resolveYU(e,t,n){var a=e.collider.mass+t.collider.mass;return e.collider.moveable&&t.collider.moveable?(e.pos.y+=n*t.collider.mass/a,t.pos.y-=n*e.collider.mass/a):e.collider.moveable?t.collider.moveable||(e.pos.y+=n):t.pos.y-=n,[e,t]}function ColoursMenu(ces){function createButton(e,t,n,a,o,r,c){var i=ces.addEnt();return ces.addContext(i,"colouredBackgroundBox",[o,o,null,"black",null,5]),ces.addContext(i,"boundingBox",[n,a]),ces.addContext(i,"event",[r]),ces.addContext(i,"hoverEvent",[c]),ces.addContext(i,"hovered",[!1]),ces.addContext(i,"pos",[e,t]),ces.addContext(i,"optionsMenu",[]),i}function makeButton(e,t,n,a,o,r){var c=13*e.canvas.width/32,i=2*e.canvas.height/8-10,l=2*e.canvas.width/32,s=(5*e.canvas.height/8-30-10*n)/n;createButton(l+c/2,i+s*t+10*t+s/2,c,s,a,o,r)}function clear(){var e=ces.alle("optionsMenu");for(i in e)ces.removeEnt(e[i])}function addPallet(e,t){var n,a,o={team1:"red",team2:"blue",team3:"green",dead:"black",pointer:"black",hitExp:"yellow",accent:"yellow",behind:"white"},r=Object.keys(e);for(var c in r)o[r[c]]=e[r[c]];return n=function(e){events.push(function(e){return e.nextState=loadMenu,e.params.colours=o,e.terminate=!0,e})},a=function(e){events.push(function(e){return e.note=t,e.params.colours=o,e})},[n,a]}function defaultColours(e){var t={team1:"red",team2:"blue",team3:"green",dead:"black",pointer:"black",hitExp:"yellow",accent:"yellow",behind:"white"};events.push(function(e){return e.nextState=loadMenu,e.params.colours=t,e.terminate=!0,e})}function defaultColoursHover(e){var t={team1:"red",team2:"blue",team3:"green",dead:"black",pointer:"black",hitExp:"yellow",accent:"yellow",behind:"white"};events.push(function(e){return e.note='"Default"',e.params.colours=t,e})}function newColours(e){var t={team1:"#fb6542",team2:"#375e97",team3:"#3f681c",dead:"black",pointer:"black",hitExp:"#ffbb00",accent:"#ffbb00",behind:"white"};events.push(function(e){return e.nextState=loadMenu,e.params.colours=t,e.terminate=!0,e})}function newColoursHover(e){var t={team1:"#fb6542",team2:"#375e97",team3:"#3f681c",dead:"black",pointer:"black",hitExp:"#ffbb00",accent:"#ffbb00",behind:"white"};events.push(function(e){return e.note='"Watermelon Lagoon"',e.params.colours=t,e})}function init(ctx,params){var state,time=(new Date).getTime();state={terminate:!1,type:"coloursMenu",params:params,nextState:loadMenu,cleanup:clear,matches:{number:0,list:{}},note:""},makeButton(ctx,1,3,["#fb6542","#3f681c","#375e97","#ffbb00"],newColours,newColoursHover),makeButton(ctx,0,3,["red","green","blue","yellow"],defaultColours,defaultColoursHover);var pallet1={team1:"#F0A830",team2:"#5E412F",team3:"#78C0A8",dead:"#332E2C",pointer:"#332E2C",hitExp:"#F07818",accent:"#F07818",behind:"#FCEBB6"},e,e1,e2;e=addPallet(pallet1,'"ZOË M1"'),e1=e[0],e2=e[1],makeButton(ctx,2,3,["#F0A830","#78C0A8","#5E412F","#F07818","#332E2C","#FCEBB6"],e1,e2),gameloop(state,eval,draw,ctx,time,frames)}function eval(e,t,n,a){var o=t.click,r=t.pos;return t=escape(t,escapeCallback(optionsMenu)),updateButtons(r,o,[null]),0==events.length&&(e.note=""),e=checkForEvents(e)}function draw(e,t){var n=findColourGen(e.params.colours);t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=n("red"),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=n("green"),t.fillRect(0,7*t.canvas.height/8,t.canvas.width,1*t.canvas.height/8),t.fillStyle=n("white"),t.fillRect(1*t.canvas.width/32,2*t.canvas.height/8-25,15*t.canvas.width/32,5*t.canvas.height/8),t.fillStyle=n("black"),t.font="60px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText("Select Colours to Continue",t.canvas.width/2,.1*t.canvas.height),t.fillStyle=n("black"),t.font="30px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText(e.note,t.canvas.width/2,15*t.canvas.height/16),drawAlphaLogo(t,n),drawColouredButtons(t)}var state=null;return init}function contextPos(e,t){return{x:e,y:t}}function contextMoveKeys(){return{keys:[]}}function contextId(e){return{id:e}}function contextVelocity(e,t){return{x:e,y:t}}function contextBullet(e,t,n){return{team:e,range:t,start:n}}function contextDraw(e,t,n,a,o,r,c,i,l,s,d){return{shape:e,damageDt:200,timeDamage:0,damageFlag:!1,damage:"yellow",strokeColour:t,radius:n,colour:"black",team1:a,team2:o,team3:r,dead:c,pointer:i,hitExp:l,accent:s,behind:d}}function contextDirection(e,t){return{x:e,y:t}}function contextRectCollider(e,t,n,a,o,r){return{x:e,y:t,inverted:n,moveable:a,mass:o,event:r}}function contextPlayer(){return{}}function contextAlive(e){return{alive:e}}function contextCircle(e){return{radius:e}}function contextExplosion(e,t){return{team:e,finalRadius:t}}function contextExpanding(e){return{rate:e}}function contextOtherPlayer(){return{}}function contextOtherPlayerLive(){return{}}function contextSimpleAI(e){return{lrp:e,dir:-1}}function contextRemoteInput(e,t,n,a){return{x:e,y:t,signal:n}}function contextText(e,t,n,a,o,r){return{text:e,hText:t,font:n,hFont:a,colour:o,hColour:r}}function contextBackgroundBox(e,t,n,a,o,r){return{colour:e,hColour:t,stroke:n,hStroke:a,lineWidth:o,hLineWidth:r}}function contextColouredBackgroundBox(e,t,n,a,o,r){return{colours:e,hColours:t,line:n,hLine:a,width:o,hWidth:r}}function contextBoundingBox(e,t){return{w:e,h:t}}function contextHovered(e){return{state:e}}function contextEvent(e){return{fun:e}}function contextHoverEvent(e){return{fun:e}}function contextLoadMenu(){return{}}function contextLoadingScreen(){return{}}function contextMatch(){return{}}function contextColour(e){return{colour:e}}function colourOptions(e,t,n,a,o){return{red:e,blue2:t,green:n,yellow:a,black:o}}function contextHealth(e){return{health:e,max:e}}function contextPower(e,t,n){return{red:e,blue:t,green:n,max:10}}function contextPowerBuildUp(e){return{list:[],time:(new Date).getTime(),dt:e}}function contextTeam(e){return{team:e}}function contextDamage(e){return{damage:e}}function contextMatchlist(){return{}}function contextOptionsMenu(){return{}}function initLoading(e,t){var n=new Date;e.canvas.style.cursor="none",null!=t&&void 0!=t||console.log("Error: Params Not Initialized"),menu={type:"loading",terminate:!1,params:t,matches:{number:0,list:{}},nextState:function(){},cleanup:clearLoadingScreen,note:""},gameloop(menu,evalLoading,drawLoading,e,n.getTime(),frames)}function evalLoading(e,t,n,a){return e=checkForEvents(e)}function drawLoading(e,t){var n=findColourGen(e.params.colours);t.fillStyle=n("red"),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=n("green"),t.fillRect(0,0,t.canvas.width,t.canvas.height/8),t.fillRect(0,7*t.canvas.height/8,t.canvas.width,t.canvas.height/8),t.fillStyle=n("black"),t.font="60px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText("Loading ...",t.canvas.width/2,.5*t.canvas.height),drawAlphaLogo(t,n)}function main(){var e;document.getElementById("mainGame").innerHTML="<canvas id='gameCanvas' width='800' height='600'></canvas>",(e=document.getElementById("gameCanvas").getContext("2d")).canvas.addEventListener("click",function(t){click(t,e)},!1),e.canvas.addEventListener("mousemove",function(t){mousemove(t,e)},!1),document.addEventListener("keydown",function(e){keyboard(e,"down")},!1),document.addEventListener("keyup",function(e){keyboard(e,"up")},!1);params={_atest:"",colours:{team1:"red",team2:"blue",team3:"green",dead:"black",pointer:"black",hitExp:"yellow",accent:"yellow",behind:"white"}},coloursMenu(e,params)}function checkForEvents(e){for(var t in events)e=events[t](e);return events=[],e}function escapeCallback(e){return function(){events.push(function(t){return t.nextState=e,t.terminate=!0,t})}}function findColourGen(e){return function(t){return e[{red:"team1",blue:"team2",green:"team3",black:"dead",yellow:"hitExp",white:"behind"}[t]]}}function drawAlphaLogo(e,t){e.fillStyle=t("black"),e.textBaseline="middle",e.textAlign="center",e.font="30px Impact",e.fillText("ALPHA V0.1.1",e.canvas.width-100,15*e.canvas.height/16)}function matchFunction(e,t){return function(e,t){events.push(function(n){return n.terminate=!0,n.nextState=function(n,a){initMatch(n,a,t,e)},n})}}function gameloop(game,eval,draw,ctx,time,dt){var date,wait,end,start=new Date,inputs=getInputs();if((game=eval(game,inputs,ctx,dt)).terminate)return game.cleanup(),game.nextState(ctx,game.params),-1;draw(game,ctx),end=new Date,(wait=end.getTime()-start.getTime())<frames?setTimeout(function(){var date=new Date;window.requestAnimationFrame(function(){gameloop(game,eval,draw,ctx,date.getTime(),date.getTime()-time)})},frames-wait):(date=new Date,window.requestAnimationFrame(function(){gameloop(game,eval,draw,ctx,date.getTime(),date.getTime()-time)}))}function click(e,t){mouse.click={x:e.pageX-t.canvas.offsetLeft,y:e.pageY-t.canvas.offsetTop}}function mousemove(e,t){mouse.pos={x:e.pageX-t.canvas.offsetLeft,y:e.pageY-t.canvas.offsetTop}}function keyboard(e,t){var n={65:"left",37:"left",87:"up",38:"up",68:"right",39:"right",83:"down",40:"down"},a={32:{name:"shoot",val:!0},27:{name:"escape",val:!0}};n.hasOwnProperty(e.keyCode)&&("down"!=t||keys.moves.includes(n[e.keyCode])||(keys.moves.push(n[e.keyCode]),moveKeyDown(n[e.keyCode])),"up"==t&&(keys.moves=keys.moves.filter(function(t){return t!=n[e.keyCode]}),moveKeyUp(n[e.keyCode]))),a.hasOwnProperty(e.keyCode)&&("down"==t&&!keys.actions.filter(function(t){return!Object.is(t,a[e.keyCode])}).length>0&&keys.actions.push(a[e.keyCode]),"up"==t&&(keys.actions=keys.actions.filter(function(t){return Object.is(t,a[e.keyCode])})))}function getInputs(){var e=Object.assign({},mouse),t=Object.assign({},forumButton);return forumButton.toggleConnection=!1,mouse.click=null,e.keydown=keys,e.button=t,e}function updateCamera(e,t){return mouseCameraAlt(e,t)}function swapColour(e,t,n,a){var o=e.tiles[t.x][t.y].type;return e.tiles[t.x][t.y].type=o==n?a:n,e.grid=fullGridDraw(e),e}function animate(e,t){var n=e.c2e.draw();for(i in n)drawtype=e.ents[i].contexts.draw.drawtype,e.systems[drawtype](e.ents[i])}function fullGridDraw(e){e.dim;var t=e.tileSize,n={x:e.tiles.length,y:e.tiles[0].length},a=document.createElement("canvas"),o=a.getContext("2d");a.width=n.x*t.x,a.height=n.y*t.y;for(var r=0;r<n.x;r++)for(var c=0;c<n.y;c++)o.beginPath(),o.rect(r*t.x,c*t.y,t.x,t.y),type=e.tiles[r][c].type,o.fillStyle=e.types[type].colour,o.strokeStyle="black",o.fill();var i=new Image;return i.src=a.toDataURL(),i.crossOrigin="Anonymous",i}function openSocket(){}function closeSocket(){websocketClose(),forumButton.toggleConnection=!0}function initMatch(ctx,params,tiles,player){var game,date,x=ctx.canvas.width,y=ctx.canvas.height;null!=params&&void 0!=params||console.log("Error: Params Not Initializes"),ctx.canvas.style.cursor="none",definePlayer(player,params.colours);var findColour=function(e){return params.colours[{red:"team1",blue:"team2",green:"team3",black:"dead",yellow:"hitExp",white:"behind"}[e]]};game={type:"match",terminate:!1,nextState:loadMenu,params:params,cleanup:clearMatch,version:"0.1",fps:[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],matches:{number:0,list:{}},highlight:null,tiles:tiles,playerAlive:!0,tileSize:{x:75,y:75},camera:{x:0,y:0},types:{grass:{colour:findColour("green")},earth:{colour:findColour("red")},water:{colour:findColour("blue")}},dim:{x:x,y:y},ces:c2e},game.grid=fullGridDraw(game),game.range={x:game.tiles.length*game.tileSize.x,y:game.tiles[0].length*game.tileSize.y},defineBoundBox(game.range.x,game.range.y),createQuickMatchButton("Join New Match",function(e){sendExit(),events.push(function(e){return e.terminate=!0,e.nextState=loadMenu,e})},pass0,ctx.canvas.width/2,.75*ctx.canvas.height),date=new Date,gameloop(game,eval,draw,ctx,date.getTime(),frames)}function keyAction(e,t,n){return e.keydown.actions.filter(function(e){return e.name==t&&1==e.val}).length>0&&(e.keydown.actions=e.keydown.actions.map(function(e){return e.name==t&&(e.val=!1),e}),n()),e}function escape(e,t){return keyAction(e,"escape",t)}function matchEscapeFunction(){events.push(function(e){return closeSocket(),e.nextState=loadMenu,e.terminate=!0,e})}function eval(e,t,n,a){var o=e.tileSize,r=(e.dim,Math.floor(e.dim.x/o.x),Math.floor(e.dim.y/o.y),{x:Math.floor((t.pos.x+e.camera.x)/o.x),y:Math.floor((t.pos.y+e.camera.y)/o.y)}),c=(e.camera.x,o.x,e.camera.y,o.y,t.click);e.fps.push(a),e.fps.shift();e.fps.reduce(function(e,t){return e+t}),e.fps.length;if(t=escape(t,matchEscapeFunction),e.playerAlive&&(null!=c&&({x:Math.floor((c.x+e.camera.x)/o.x),y:Math.floor((c.y+e.camera.y)/o.y)},clickCreateExplosion(c.x+e.camera.x,c.y+e.camera.y)),playerUpdateDirection(mouse,e.camera),e.highlight=r,t.keydown.actions.filter(function(e){return"shoot"==e.name&&1==e.val}).length>0&&(t.keydown.actions=t.keydown.actions.map(function(e){return"shoot"==e.name&&(e.val=!1),e}),playerCreateBullet()),t.keydown.moves.length>0))for(var i in t.keydown.moves)move(t.keydown.moves[i],Math.floor(a/33.3333*10/Math.sqrt(t.keydown.moves.length)),playerId);return runOtherPlayerAI(a/33.3333),updateBullets(a/33.3333),updateExplosions(a/33.3333),moveOthers(a/33.3333),testCollision(),updatePlayer(e.tiles,a/33.3333),e=updateCamera(e,playerPos()),updatePP(Date.now()),0==e.playerAlive&&updateButtons(t.pos,t.click,[null]),e=checkForEvents(e),websocketPing(),e}function draw(e,t){e.camera,e.dim;var n=e.tileSize,a=(Math.floor(e.dim.x/n.x),Math.floor(e.dim.y/n.y),Math.floor(e.camera.x/n.x),Math.floor(e.camera.y/n.y),findColourGen(e.params.colours));t.drawImage(e.grid,e.camera.x,e.camera.y,e.dim.x,e.dim.y,0,0,e.dim.x,e.dim.y),edraw(t,e.camera),odraw(t,e.camera),bdraw(t,e.camera),opldraw(t,e.camera),opdraw(t,e.camera),pdraw(t,e.camera,mouse.pos),e.highlight&&(t.beginPath(),t.rect(e.highlight.x*n.x-e.camera.x,e.highlight.y*n.y-e.camera.y,n.x,n.y),t.strokeStyle="black",t.stroke()),0==e.playerAlive&&(t.canvas.style.cursor="crosshair",t.fillStyle=a("red"),t.fillRect(200,0,t.canvas.width-400,t.canvas.height),t.fillStyle=a("black"),t.font="40px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText("Search and Destroy",t.canvas.width/2,.1*t.canvas.height),t.font="35px Impact",t.fillText("Colours of Destiny",t.canvas.width/2,.2*t.canvas.height),t.fillStyle=a("black"),t.font="60px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText("Ship Down",t.canvas.width/2,.5*t.canvas.height),drawButtons(t,e.params.colours)),drawAlphaLogo(t,a)}function updatePP(e){e-positionPlayer.ptime>1e3&&(sendPlayerPos(),positionPlayer.ptime=e)}function matchlistWrapper(e){return function(t,n){matchlist(t,n,e)}}function matchlist(e,t,n){var a,o=(new Date).getTime(),r=function(e){return function(){events.push(function(t){var n=(new Date).getTime(),a="0";for(var o in t.matches.list)Object.keys(t.matches.list[o])==e&&(a=Object.values(t.matches.list[o]));return t.note="Available Slots: "+a,t.nextRequest<n&&(match_api("request_matches"),t.nextRequest=n+t.requestFrequency),t})}},c=function(){events.push(function(e){return e.note="Not Implemented",e})},i=function(t){return function(n){events.push(function(a){return n.match=t,a.nextState=initLoading,a.terminate=!0,websocketOpen(matchFunction(e,a.params),n),a})}},l=function(e){events.push(function(e){return match_api("new_match"),e})};e.canvas.style.cursor="crosshair",a={type:"matchlist",terminate:!1,nextState:initLoading,params:t,cleanup:clearMatchlist,matches:n,requestFrequency:5e3,nextRequest:o,updateButtons:function(){clearMatchlist(),createMatchListButtons(e,a.matches,i,r,l,r),createPlayerGrid(e,[],pass1,c)},note:""},createPlayerGrid(e,[],pass1,c),createMatchListButtons(e,a.matches,i,r,l,r),gameloop(a,matchlisteval,matchlistdraw,e,o,frames)}function matchlistEscapeFunction(){events.push(function(e){return e.nextState=loadMenu,e.terminate=!0,e})}function matchlisteval(e,t,n,a){var o=t.click,r=t.pos;return t=escape(t,matchlistEscapeFunction),updateButtons(r,o,[{}]),0==events.length&&(e.note=""),e=checkForEvents(e)}function matchlistdraw(e,t){var n=findColourGen(e.params.colours);t.fillStyle=n("red"),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=n("green"),t.fillRect(t.canvas.width/2,2*t.canvas.height/8-25,15*t.canvas.width/32,5*t.canvas.height/8),t.fillStyle=n("green"),t.fillRect(0,7*t.canvas.height/8,t.canvas.width,1*t.canvas.height/8),t.fillStyle=n("black"),t.font="60px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText("Available Matches",t.canvas.width/2,.1*t.canvas.height),t.font="30px Impact",t.fillText(e.note,t.canvas.width/2,15*t.canvas.height/16),drawAlphaLogo(t,n),drawButtons(t,e.params.colours)}function matches(e){events.push(function(t){return"menu"!=t.type&&"matchlist"!=t.type||(null==e?(t.matches.number=0,t.matches.list={},t.nextState=matchlistWrapper(t.matches)):(t.matches.number=e.length,t.matches.list=e,t.nextState=matchlistWrapper(t.matches))),"matchlist"==t.type&&t.updateButtons(),t})}function loadMenu(e,t){var n=new Date;null!=t&&void 0!=t||console.log("Error: Params Not Initializes");var a=(new Date).getTime();match_api("request_matches"),e.canvas.style.cursor="crosshair",createQuickButton("Join as Guest",function(e){events.push(function(e){return e.terminate=!0,e})},function(){events.push(function(e){var t=(new Date).getTime();return e.nextRequest<t&&(match_api("request_matches"),e.nextRequest=t+e.requestFrequency),e.note="Active Matches: "+e.matches.number,e})},e.canvas.width/2,e.canvas.height/2+35),createQuickButton("Sign In",function(e){},notImplementedHover,e.canvas.width/2,e.canvas.height/2+95),createQuickButton("Options",function(e){events.push(function(e){return e.nextState=optionsMenu,e.terminate=!0,e})},notImplementedHover,e.canvas.width/2,e.canvas.height/2+155),menu={terminate:!1,type:"menu",params:t,nextState:matchlistWrapper({number:0,list:{}}),cleanup:clearLoadMenu,matches:{number:0,list:{}},requestFrequency:1e3,nextRequest:a,note:""},gameloop(menu,meval,mdraw,e,n.getTime(),frames)}function meval(e,t,n,a){var o=t.click;return updateButtons(t.pos,o,[null]),0==events.length&&(e.note=""),e=checkForEvents(e)}function mdraw(e,t){var n=findColourGen(e.params.colours);t.fillStyle=n("red"),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=n("green"),t.fillRect(0,0,t.canvas.width,t.canvas.height/8),t.fillRect(0,7*t.canvas.height/8,t.canvas.width,t.canvas.height/8),t.fillStyle=n("black"),t.font="60px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText("Search and Destroy",t.canvas.width/2,.3*t.canvas.height),t.font="50px Impact",t.fillText("Colours of Destiny",t.canvas.width/2,.4*t.canvas.height),drawAlphaLogo(t,n),drawButtons(t,e.params.colours)}function websocketPing(){websocketSendEvent("message","hello world!")}function websocketSendPos(e){websocketSendEvent("updatePlayerPos",e)}function websocketSendEvent(e,t){if(void 0!=ws.readyState&&ws.readyState===ws.OPEN){var n={type:e,body:t,id:clientID,time:Date.now()};ws.send(JSON.stringify(n))}}function websocketClose(){ws.close()}function websocketOpen(e,t){window.WebSocket||alert("Browser Not Suported"),(ws=new WebSocket(address)).onopen=function(){t.name?websocketSendEvent("req_id",t.name):websocketSendEvent("req_id","guest")},ws.onmessage=function(n){var a={createExplosion:createExplosion,createBullet:createBullet,updatePlayerPos:updatePlayerPos,damaged:damaged,dead:dead,keyUp:keyUp,keyDown:keyDown,colourChanged:colourChanged,turned:turned,exitMatch:exitMatch},o=JSON.parse(n.data);1==lognet.rec&&console.log("V10 Log: Message Rec: "+n.data),"req_id"==o.type?(t.match?websocketSendEvent("req_specific_match",t.match):websocketSendEvent("req_match",""),req_id(o.id)):"create"==o.type?e(o.body.player,JSON.parse(o.body.tiles)):a[o.type]&&a[o.type].apply(void 0,Object.values(o.body))},ws.onclose=function(){}}function req_id(e){clientID=e}function match_api(e){xhttp.open("GET","/api/v0/match?"+e,!0),xhttp.send(null)}function OptionsMenu(ces){function createButton(e,t,n,a,o,r,c,i,l,s,d){var u=ces.addEnt();return ces.addContext(u,"text",[e,e,r,c,i,i]),ces.addContext(u,"backgroundBox",[l,l,null,"black",null,5]),ces.addContext(u,"boundingBox",[a,o]),ces.addContext(u,"event",[s]),ces.addContext(u,"hoverEvent",[d]),ces.addContext(u,"hovered",[!1]),ces.addContext(u,"pos",[t,n]),ces.addContext(u,"optionsMenu",[]),u}function quickButton(e,t,n,a,o){createButton(e,400,150+60*a,300,50,"30px Impact","40px Impact","white","blue",t,n)}function confirmButtons(){buttons.map(function(e){e.push(buttons.length),quickButton.apply(void 0,e)})}function addButton(e,t,n){buttons.push([e,t,n,buttons.length])}function clear(){var e=ces.alle("optionsMenu");for(i in e)ces.removeEnt(e[i]);buttons=[]}function selectColoursHover(){events.push(function(e){return e.note="Change Colour Scheme",e})}function selectColourEvent(e){events.push(function(e){return e.nextState=coloursMenu,e.terminate=!0,e})}function init(ctx,params){var state,time=(new Date).getTime();addButton("Colours",selectColourEvent,selectColoursHover),addButton("Controls",pass1,notImplementedHover),addButton("Network",pass1,notImplementedHover),addButton("Button4",pass1,notImplementedHover),confirmButtons(),state={terminate:!1,type:"optionsMenu",params:params,nextState:loadMenu,cleanup:clear,matches:{number:0,list:{}},note:""},gameloop(state,eval,draw,ctx,time,frames)}function eval(e,t,n,a){var o=t.click,r=t.pos;return t=escape(t,escapeCallback(loadMenu)),updateButtons(r,o,[null]),0==events.length&&(e.note=""),e=checkForEvents(e)}function draw(e,t){var n=findColourGen(e.params.colours);t.fillStyle=n("red"),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=n("green"),t.fillRect(0,7*t.canvas.height/8,t.canvas.width,1*t.canvas.height/8),t.fillStyle=n("black"),t.font="60px Impact",t.textBaseline="middle",t.textAlign="center",t.fillText("Options",t.canvas.width/2,.1*t.canvas.height),t.fillStyle=n("black"),t.font="30px Impact",t.textAlign="center",t.fillText(e.note,t.canvas.width/2,15*t.canvas.height/16),drawAlphaLogo(t,n),drawButtons(t,menu.params.colours)}var buttons=[],state=null;return init}function systemDrawOtherPlayer(e,t,n){var a=e.draw,o=e.pos,r=e.direction,c=triangle(o.x-n.x+25+20*r.x,o.y-n.y+25+20*r.y,20,20,Math.atan2(r.y,r.x));return t.fillStyle=e.colour.colour,t.beginPath(),t.arc(o.x-n.x+a.radius,o.y-n.y+a.radius,a.radius,0,2*Math.PI),t.fill(),fillPoly(t,c,a.fillColour),e}function systemUpdateOtherPlayerLive(e,t,n,a,o,r){return e.pos=t,e.team.team=n,e.alive.alive=o,e.alive.alive&&(e.colour.colour=a),e.direction=r,e.draw.colour=a,e}function systemOtherDamage(e,t){var n=t.colour.colour,a=t.id.id,o=(t.damage.damage,new Date);return e.colour.colour!=n&&e.id.id!=a&&(e.draw.timeDamage=o.getTime(),e.draw.damageFlag=!0,t=null),[e,t]}function systemMoveOtherPlayer(e,t,n){var a=e.moveKeys.keys;if(a.length>0)for(var o in a)move(a[o],Math.floor(10*n/Math.sqrt(a.length)),t);return e}function systemTurnOther(e,t){return e.direction=t,e}function systemSetOtherColour(e,t){return e.alive&&(e.colour.colour=t),e}function systemSendExit(e){return websocketSendEvent("exitMatch",{matchid:e.id.id,id:clientID}),closeSocket(),e}function systemReceiveExit(e){return null}function systemDie(e){return e.alive.alive=!1,e.colour.colour="black",e.draw.colour="black",events.push(function(e){return e.playerAlive=!1,e}),websocketSendEvent("dead",{alive:e.alive.alive,matchid:e.id.id,id:clientID}),e}function systemReceiveDead(e,t){return e.alive.alive=t,0==t&&(e.colour.colour="black",e.draw.colour="black"),e}function systemSendKey(e,t,n){return websocketSendEvent(t,{key:n,id:e.id.id}),e}function systemReceiveKeyDown(e,t){return e.alive.alive?e.moveKeys.keys.push(t):e.moveKeys.keys=[],e}function systemReceiveKeyUp(e,t){var n=e.moveKeys.keys.filter(function(e){return e!=t});return e.alive.alive?e.moveKeys.keys=n:e.moveKeys.keys=[],e}function systemDamage(e,t){var n=t.colour.colour,a=t.id.id,o=t.damage.damage,r=new Date;return e.alive.alive&&e.colour.colour!=n&&e.id.id!=a&&(e.health.health-=o,e.health.health<0?(e.health.health=0,e=systemDie(e)):(e.draw.timeDamage=r.getTime(),e.draw.damageFlag=!0),websocketSendEvent("damaged",{bullet:t.uid.id,health:e.health.health,alive:e.alive.alive,time:r.getTime(),matchid:e.id.id,id:clientID}),t=null),[e,t]}function systemDamageAnimate(e,t){return e.draw.damageFlag&&(t-e.draw.timeDamage<e.draw.damageDt?e.colour.colour=e.draw.damage:(e.draw.damageFlag=!1,e.colour.colour=e.draw.colour)),e}function systemSendPos(e){return websocketSendPos({pos:e.pos,team:e.team.team,colour:e.colour.colour,alive:e.alive.alive,dir:e.direction,matchid:e.id.id,id:clientID}),e}function systemSendAngle(e){return websocketSendEvent("turned",{direction:e.direction,matchid:e.id.id}),e}function systemPlayerCreateBullet(e){var t,n={},a={x:25*e.direction.x,y:25*e.direction.y},o=e.power;return n.x=e.pos.x+25+25*e.direction.x,n.y=e.pos.y+25+25*e.direction.y,o.red+o.blue+o.green>0&&(t=maxColour(o.red,o.blue,o.green),e.power[t]=e.power[t]-1,websocketSendEvent("createBullet",{pos:n,velocity:a,range:{x:500,y:500},team:e.team,colour:t,matchid:e.id.id})),e}function systemUpdatePlayer(e,t,n,a){var o,n=new Date,r=e.powerBuildUp,c=e.pos,i=e.collider.x,l=e.collider.y,s=e.direction,d=e.sentDirection;.038429439<(d.x-s.x)*(d.x-s.x)+(d.y-s.y)*(d.y-s.y)&&(websocketSendEvent("turned",{direction:s,matchid:e.id.id}),e.sentDirection.x=s.x,e.sentDirection.y=s.y);var u=tileOverlap(t,a,c.x,c.x+i,c.y,c.y+l);return e.powerBuildUp.list.push(u),n-r.time>r.dt&&(o=tileOverlapMaxColour(e.powerBuildUp.list),e.power.red+e.power.blue+e.power.green<e.power.max?e.power[o]+=1:(e.power[maxColour(e.power.red,e.power.blue,e.power.green)]-=1,e.power[o]+=1),e.colour.colour=maxColour(e.power.red,e.power.blue,e.power.green),e.draw.colour=e.colour.colour,e.powerBuildUp.time=n.getTime(),e.powerBuildUp.list=[]),e}function systemMovePlayer(e,t){return e.pos.x+=t.x,e.pos.y+=t.y,e}function systemSimpleAI(e,t){var n=e.simpleAI,a=e.direction;return Math.random()<n.lrp&&(n.dir=-1*n.dir),a=rotate(a,n.dir*Math.PI/128),e=systemMovePlayer(e,{x:3*a.x*t,y:3*a.y*t}),e.direction=a,e}function systemPlayerDirection(e,t,n){var a=t.pos,o=e.pos,r=a.y-(o.y-n.y+25),c=a.x-(o.x-n.x+25),i=Math.sqrt(r*r+c*c);return e.direction.x=c/i,e.direction.y=r/i,e}function systemUpdateBullet(e,t,n){return e.pos.x=e.pos.x+e.velocity.x*t,e.pos.y=e.pos.y+e.velocity.y*t,(Math.abs(e.bullet.start.x-e.pos.x)>e.bullet.range.x||Math.abs(e.bullet.start.y-e.pos.y)>e.bullet.range.y)&&(e=null),e}function systemUpdateExplosion(e,t,n){var a=e.expanding.rate*t;return e.circle.radius+=a,e.draw.radius=e.circle.radius,e.pos.x-=a,e.pos.y-=a,e.circle.radius>e.explosion.finalRadius&&(e=null),e}function systemDrawObj(e,t,n){var a=e.draw,o=e.pos,r=e.colour.colour;return t.strokeStyle=a.strokeColour,t.fillStyle=r,t.beginPath(),t.arc(o.x-n.x+a.radius,o.y-n.y+a.radius,a.radius,0,2*Math.PI),t.stroke(),t.fill(),e}function systemDeath(e,t){return systemTriggerCollide(e,t)}function systemDrawPlayer(e,t,n,a){var o=e.draw,r=function(t){return e.draw[{red:"team1",blue:"team2",green:"team3",black:"dead",yellow:"hitExp",white:"behind"}[t]]},c=r(e.colour.colour),i=e.pos,l=e.direction,s=e.health,d=(s.health-s.max/2)/s.max,u=e.power,y=triangle(i.x-n.x+25+20*l.x,i.y-n.y+25+20*l.y,20,20,Math.atan2(l.y,l.x));return fillPoly(t,trunktriangle(i.x-n.x+25,i.y-n.y+25,50,8e3,-1e4,Math.atan2(l.y,l.x)),r("white")),t.beginPath(),t.moveTo(i.x-n.x+o.radius,i.y-n.y+o.radius),t.lineTo(a.x,a.y),t.strokeStyle=r("black"),t.stroke(),t.strokeStyle=o.strokeColour,t.fillStyle=c,t.beginPath(),t.arc(i.x-n.x+o.radius,i.y-n.y+o.radius,o.radius,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(i.x-n.x+o.radius,i.y-n.y+o.radius,o.radius/1.5,0,2*Math.PI),t.fillStyle=r("yellow"),t.fill(),t.beginPath(),t.arc(i.x-n.x+o.radius,i.y-n.y+o.radius,o.radius/2,0,2*Math.PI*u.blue/u.max,!1),t.lineWidth=4,t.strokeStyle=r("blue"),t.stroke(),t.beginPath(),t.arc(i.x-n.x+o.radius,i.y-n.y+o.radius,o.radius/2,2*Math.PI*u.blue/u.max,2*Math.PI*(u.green+u.blue)/u.max,!1),t.lineWidth=4,t.strokeStyle=r("green"),t.stroke(),t.beginPath(),t.arc(i.x-n.x+o.radius,i.y-n.y+o.radius,o.radius/2,2*Math.PI*(u.blue+u.green)/u.max,2*Math.PI*(u.red+u.green+u.blue)/u.max,!1),t.lineWidth=4,t.strokeStyle=r("red"),t.stroke(),t.beginPath(),t.arc(i.x-n.x+o.radius,i.y-n.y+o.radius,o.radius/4,Math.PI+Math.PI*d,0-Math.PI*d,!0),t.fillStyle=c,t.fill(),t.lineWidth=1,fillPoly(t,y,c),e}function systemDrawButton(e,t,n){var a=findColourGen(n);return e.hovered.state?(t.fillStyle=a(e.backgroundBox.hColour),t.fillRect(e.pos.x-e.boundingBox.w/2,e.pos.y-e.boundingBox.h/2,e.boundingBox.w,e.boundingBox.h),t.strokeStyle=a(e.backgroundBox.hStroke),t.lineWidth=e.backgroundBox.hLineWidth,t.strokeRect(e.pos.x-e.boundingBox.w/2,e.pos.y-e.boundingBox.h/2,e.boundingBox.w,e.boundingBox.h),t.fillStyle=e.text.hColour,t.font=e.text.hFont,t.textAlign="center",t.textBaseline="middle",t.fillText(e.text.hText,e.pos.x,e.pos.y)):(t.fillStyle=a(e.backgroundBox.colour),t.fillRect(e.pos.x-e.boundingBox.w/2,e.pos.y-e.boundingBox.h/2,e.boundingBox.w,e.boundingBox.h),t.fillStyle=a(e.text.colour),t.font=e.text.font,t.textAlign="center",t.textBaseline="middle",t.fillText(e.text.text,e.pos.x,e.pos.y)),e}function systemUpdateButton(e,t,n,a){var o={xmin:e.pos.x-e.boundingBox.w/2,ymin:e.pos.y-e.boundingBox.h/2,xrange:e.boundingBox.w,yrange:e.boundingBox.h},r=function(e,t){var n=e.x,a=e.y,o=t.xmin,r=t.xrange,c=t.ymin,i=t.yrange;return n>o&&n<o+r&&a>c&&a<c+i};return r(t,o)?(e.hovered.state=!0,e.hoverEvent.fun()):e.hovered.state=!1,void 0!=n&&r(n,o)&&e.event.fun.apply(void 0,a),e}function systemDrawColouredButton(e,t){var n,a,o=e.pos.x-e.boundingBox.w/2,r=e.pos.y-e.boundingBox.h/2;n=(a=e.hovered.state?e.colouredBackgroundBox.hColours:e.colouredBackgroundBox.colours).length;for(var c in a)t.fillStyle=a[c],t.fillRect(o+e.boundingBox.w/n*c,r,e.boundingBox.w/n,e.boundingBox.h);return e.hovered.state&&(t.lineWidth=e.colouredBackgroundBox.hWidth,t.strokeRect(e.pos.x-e.boundingBox.w/2,e.pos.y-e.boundingBox.h/2,e.boundingBox.w,e.boundingBox.h)),e}var c2e=new CES,optionsMenu=OptionsMenu(c2e),coloursMenu=ColoursMenu(c2e);c2e.defcontext("pos",contextPos),c2e.defcontext("draw",contextDraw),c2e.defcontext("player",contextPlayer),c2e.defcontext("alive",contextAlive),c2e.defcontext("collider",contextRectCollider),c2e.defcontext("velocity",contextVelocity),c2e.defcontext("team",contextTeam),c2e.defcontext("direction",contextDirection),c2e.defcontext("sentDirection",contextDirection),c2e.defcontext("otherPlayer",contextOtherPlayer),c2e.defcontext("otherPlayerLive",contextOtherPlayerLive),c2e.defcontext("remoteInput",contextRemoteInput),c2e.defcontext("simpleAI",contextSimpleAI),c2e.defcontext("bullet",contextBullet),c2e.defcontext("expanding",contextExpanding),c2e.defcontext("circle",contextCircle),c2e.defcontext("explosion",contextExplosion),c2e.defcontext("id",contextId),c2e.defcontext("uid",contextId),c2e.defcontext("text",contextText),c2e.defcontext("backgroundBox",contextBackgroundBox),c2e.defcontext("boundingBox",contextBoundingBox),c2e.defcontext("hovered",contextHovered),c2e.defcontext("event",contextEvent),c2e.defcontext("clickEvent",contextEvent),c2e.defcontext("hoverEvent",contextEvent),c2e.defcontext("colour",contextColour),c2e.defcontext("health",contextHealth),c2e.defcontext("power",contextPower),c2e.defcontext("damage",contextDamage),c2e.defcontext("powerBuildUp",contextPowerBuildUp),c2e.defcontext("moveKeys",contextMoveKeys),c2e.defcontext("colouredBackgroundBox",contextColouredBackgroundBox),c2e.defcontext("match",contextMatch),c2e.defcontext("loadMenu",contextLoadMenu),c2e.defcontext("loadingScreen",contextLoadingScreen),c2e.defcontext("matchlist",contextMatchlist),c2e.defcontext("optionsMenu",contextOptionsMenu),c2e.defsystem("receiveExit",systemReceiveExit,[]),c2e.defsystem("sendExit",systemSendExit,[]),c2e.defsystem("die",systemDie,[]),c2e.defsystem("receiveDead",systemReceiveDead,[]),c2e.defsystem("turnOther",systemTurnOther,[]),c2e.defsystem("turnOther",systemTurnOther,[]),c2e.defsystem("setOtherColour",systemSetOtherColour,[]),c2e.defsystem("moveOtherPlayer",systemMoveOtherPlayer,[]),c2e.defsystem("receiveKeyDown",systemReceiveKeyDown,[]),c2e.defsystem("receiveKeyUp",systemReceiveKeyUp,[]),c2e.defsystem("sendKey",systemSendKey,[]),c2e.defsystem("damage",systemDamage,[]),c2e.defsystem("otherDamage",systemOtherDamage,[]),c2e.defsystem("damageAnimate",systemDamageAnimate,[]),c2e.defsystem("updatePlayer",systemUpdatePlayer),c2e.defsystem("playerCreateBullet",systemPlayerCreateBullet),c2e.defsystem("updateButton",systemUpdateButton,systemUpdateButtonReqs),c2e.defsystem("drawButton",systemDrawButton,systemDrawButtonReqs),c2e.defsystem("drawColouredButton",systemDrawColouredButton,[]),c2e.defsystem("sendPos",systemSendPos,[]),c2e.defsystem("sendAngle",systemSendAngle,[]),c2e.defsystem("updateBullet",systemUpdateBullet,[]),c2e.defsystem("updateExplosion",systemUpdateExplosion,[]),c2e.defsystem("updateOtherPlayerLive",systemUpdateOtherPlayerLive,[]),c2e.defsystem("death",systemDeath,[]),c2e.defsystem("simpleAI",systemSimpleAI,[["pos","otherPlayer"]]),c2e.defsystem("movePlayer",systemMovePlayer,[["pos","player"]]),c2e.defsystem("drawObj",systemDrawObj,[["pos","draw"]]),c2e.defsystem("drawPlayer",systemDrawPlayer,[["pos","draw","dir"]]),c2e.defsystem("drawOtherPlayer",systemDrawOtherPlayer,[["pos","draw","dir"]]),c2e.defsystem("collide",systemCollide,[["pos","collider"].collider]),c2e.defsystem("collideI",systemInverseCollide,[["pos","collider"].collider]),c2e.defsystem("triggerCollide",systemTriggerCollide,[]),c2e.defsystem("playerDirection",systemPlayerDirection,[["direction"]]);var playerId,bounds,object=[],otherPlayersLive={},otherPlayers=[],frames=1e3/60,mouse={pos:{x:null,y:null},click:null},keys={moves:[],actions:[]},positionPlayer={ptime:Date.now(),pos:[]},forumButton={toggleConnection:!1},events=[],notImplementedHover=function(){events.push(function(e){return e.note="Not Implemented",e})},ws=new Object,clientID=0,lognet={};lognet.rec=!1;var address="ws://sadcod.com/websocket",xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e={matches:matches},t=JSON.parse(xhttp.responseText);e[t.type]&&e[t.type](t.body)}};var systemDrawButtonReqs=["text","backgroundBox","boudningBox","pos","hovered"],systemUpdateButtonReqs=["clickable","hovered","boundingBox","pos","event","hoverEvent"];
